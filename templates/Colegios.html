<!DOCTYPE html>
<html lang="es">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Smart Books | Colegios</title>
    <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css">
    <link rel="stylesheet" href="./style.css"> <style>
        /* Estilos CSS adicionales */
        .dropdown-content {
            max-height: 0;
            overflow: hidden;
            transition: max-height 0.3s ease-out, opacity 0.3s ease-out;
            opacity: 0;
            padding: 0 1rem;
        }

        .dropdown-content-visible {
            max-height: 500px; /* Suficiente para el contenido */
            opacity: 1;
        }

        .course-dropdown-container-hidden {
            opacity: 0;
            max-height: 0;
            transition: max-height 0.5s ease-out, opacity 0.5s ease-out;
            pointer-events: none; /* Deshabilita clics */
        }

        .course-dropdown-container-visible {
            opacity: 1;
            max-height: 500px; /* Suficiente para el contenido */
        }

        .dropdown-item:hover {
            background-color: #f3f4f6;
            cursor: pointer;
        }

        .school-loading {
            cursor: wait;
        }
        
        /* Estilos para animaciones de la tarjeta de resultado */
        .card-enter {
            opacity: 0;
            transform: translateY(20px);
        }

        .card-enter-active {
            opacity: 1;
            transform: translateY(0);
            transition: opacity 0.5s ease, transform 0.5s ease;
        }
        
        .sticky-nav {
            position: fixed;
            top: 0;
            width: 100%;
            z-index: 50;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -2px rgba(0, 0, 0, 0.1);
        }
        
        .main-content {
            /* Asegura que el contenido principal no quede debajo del nav fijo */
            padding-top: 130px; 
        }

        /* Estilos de scrollbar personalizados */
        .custom-scrollbar::-webkit-scrollbar {
            width: 6px; /* Ancho de la barra */
        }

        .custom-scrollbar::-webkit-scrollbar-thumb {
            background-color: #f7a01d; /* Color del "pulgar" de la barra */
            border-radius: 3px; /* Bordes redondeados */
        }

        .custom-scrollbar::-webkit-scrollbar-track {
            background: #f1f1f1; /* Color del track (fondo) */
        }

    </style>
</head>

<body class="bg-white font-sans">

    <header class="bg-white shadow-md py-4 transition duration-300 ease-in-out fixed w-full z-50" id="navbar">
        <div class="container mx-auto px-4 flex justify-between items-center">
            <div class="flex items-center">
                <img src="./img/logo_smart_books.png" alt="Smart Books Logo" class="h-10">
            </div>

            <div class="hidden lg:flex flex-1 justify-center mx-10">
                <div class="relative w-full max-w-xl">
                    <input type="text" placeholder="Buscar por palabra clave..."
                        class="w-full py-2 px-4 pr-10 border border-gray-300 rounded-full focus:outline-none focus:ring-2 focus:ring-brand-primary">
                    <button class="absolute right-0 top-0 mt-2 mr-3 text-gray-500">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>

            <div class="flex items-center space-x-4">
                <a href="#" class="bg-brand-primary text-white py-2 px-4 rounded-full font-bold hover:bg-brand-secondary transition duration-300">
                    Compra tu Kit Educativo AQUÍ
                </a>
                <a href="#" class="relative">
                    <i class="fas fa-shopping-cart text-2xl text-gray-700"></i>
                    <span
                        class="absolute top-0 right-0 -mt-2 -mr-2 bg-red-600 text-white text-xs rounded-full h-5 w-5 flex items-center justify-center">0</span>
                </a>
            </div>
        </div>
        
        <nav class="hidden lg:block border-t border-gray-100 mt-4">
            <div class="container mx-auto px-4 flex justify-center space-x-12 py-2">
                <a href="./index.html" class="text-gray-700 hover:text-brand-primary font-medium transition duration-300">Inicio</a>
                <a href="#" class="text-gray-700 hover:text-brand-primary font-medium transition duration-300 flex items-center">
                    Nosotros <i class="fas fa-chevron-down text-xs ml-1"></i>
                </a>
                <a href="#" class="text-gray-700 hover:text-brand-primary font-medium transition duration-300 flex items-center">
                    Aliados <i class="fas fa-chevron-down text-xs ml-1"></i>
                </a>
                <a href="#" class="text-gray-700 hover:text-brand-primary font-medium transition duration-300">Tienda</a>
                <a href="./colegios.html" class="text-brand-primary font-bold border-b-2 border-brand-primary">Colegios</a>
                <a href="#" class="text-gray-700 hover:text-brand-primary font-medium transition duration-300">Contáctanos</a>
                <a href="#" class="text-gray-700 hover:text-brand-primary font-medium transition duration-300">Intranet</a>
            </div>
        </nav>
    </header>

    <div class="main-content pt-32 pb-16 bg-gray-50">
        <div class="container mx-auto px-4 text-center">
            <h1 class="text-5xl font-extrabold text-gray-800">COLEGIO</h1>
            <p class="mt-4 text-lg text-gray-600">
                Selecciona tu institución y el curso para ver el kit educativo exacto que
                necesitas.
            </p>
        </div>
    </div>

    <main class="container mx-auto px-4 py-12">
        <div class="flex flex-col items-center max-w-xl mx-auto">
            
            <div class="relative w-full z-30">
                <button id="school-select-button"
                    class="w-full py-3 px-4 bg-white border border-gray-300 rounded-lg text-lg text-gray-500 font-medium flex justify-between items-center school-loading"
                    onclick="toggleDropdown('school-dropdown')" disabled>
                    Cargando Colegios...
                    <i class="fas fa-spinner fa-spin text-base ml-2"></i>
                </button>
                <div id="school-dropdown" class="absolute w-full mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 dropdown-content">
                    <input type="text" id="school-search-input" placeholder="Buscar colegio..."
                        class="w-full p-3 border-b border-gray-200 focus:outline-none rounded-t-lg" onkeyup="filterSchoolList()" disabled>
                    <div id="school-list" class="max-h-64 overflow-y-auto custom-scrollbar">
                        <div class="p-3 text-gray-500 text-center">Cargando...</div>
                    </div>
                </div>
            </div>

            <div id="course-dropdown-container" class="w-full mt-8 course-dropdown-container-hidden z-20">
                <p id="initial-message" class="text-center text-gray-600 mb-6 font-semibold">
                    Por favor, selecciona un colegio para empezar.
                </p>

                <div class="relative w-full z-20">
                    <button id="course-select-button"
                        class="w-full py-3 px-4 bg-white border border-gray-300 rounded-lg text-lg text-gray-500 font-medium flex justify-between items-center"
                        onclick="toggleDropdown('course-dropdown')" disabled>
                        Selecciona tu Curso
                        <i class="fas fa-chevron-down text-base ml-2 transition-transform duration-300"></i>
                    </button>
                    <div id="course-dropdown" class="absolute w-full mt-2 bg-white border border-gray-300 rounded-lg shadow-xl z-50 dropdown-content">
                        <div id="course-list" class="max-h-64 overflow-y-auto custom-scrollbar">
                            </div>
                    </div>
                </div>
            </div>

            <div id="package-card"
                style="display: none !important;" class="relative z-10 mx-auto w-full max-w-lg hidden text-left flex-col justify-center items-center p-4 bg-brand-primary rounded-xl shadow-lg transition-all duration-300 transform mt-4 mb-8">

                <div class="absolute inset-0 bg-gradient-to-br from-brand-primary to-blue-800 opacity-90 rounded-xl"></div>
                
                <div class="relative z-10 w-full flex items-center justify-between">
                    <div class="flex items-center space-x-4">
                        <div class="h-16 w-16 bg-white rounded-full flex items-center justify-center shadow-lg">
                            <i class="fas fa-box-open text-2xl text-brand-primary"></i>
                        </div>
                        
                        <div class="text-white">
                            <h3 class="text-xl font-extrabold mb-1">PAQUETE EDUCATIVO ENCONTRADO</h3>
                            <p class="text-sm font-semibold">
                                Colegio: <span id="card-school-name" class="font-normal"></span>
                            </p>
                            <p class="text-sm font-semibold">
                                Curso: <span id="card-course-name" class="font-normal"></span>
                            </p>
                            <p class="text-sm font-semibold">
                                Libros: <span id="card-book-count" class="font-normal"></span>
                            </p>
                        </div>
                    </div>
                    
                    <button
                        class="bg-brand-secondary text-white py-3 px-6 rounded-full font-bold hover:bg-yellow-600 transition duration-300 shadow-md transform hover:scale-105">
                        Añadir Kit Completo al Carrito
                    </button>
                </div>
            </div>

            <div id="search-loading" class="flex flex-col items-center mt-8 p-6 rounded-lg bg-gray-100 hidden">
                <i class="fas fa-spinner fa-spin text-3xl text-brand-primary mb-3"></i>
                <p class="text-gray-600 font-semibold">Buscando el kit educativo...</p>
            </div>
            
        </div>
    </main>

    <footer class="bg-gray-800 text-white py-10 mt-12">
        <div class="container mx-auto px-4">
            <div class="flex flex-wrap justify-between">
                <div class="w-full md:w-1/4 mb-6 md:mb-0">
                    <img src="./img/logo_smart_books_white.png" alt="Smart Books Logo" class="h-10 mb-4">
                    <p class="text-sm text-gray-400">Innovación y conocimiento al alcance de todos.</p>
                </div>

                <div class="w-full md:w-1/4 mb-6 md:mb-0">
                    <h4 class="text-lg font-semibold mb-3">Información de Contacto</h4>
                    <ul class="space-y-2 text-sm text-gray-400">
                        <li><i class="fas fa-map-marker-alt mr-2"></i> Cra 20 # 37-25, Bogotá</li>
                        <li><i class="fas fa-phone mr-2"></i> +57 601 744 3210</li>
                        <li><i class="fas fa-envelope mr-2"></i> contacto@smartbooks.com</li>
                    </ul>
                </div>

                <div class="w-full md:w-1/4 mb-6 md:mb-0">
                    <h4 class="text-lg font-semibold mb-3">Explorar</h4>
                    <ul class="space-y-2 text-sm">
                        <li><a href="#" class="text-gray-400 hover:text-brand-primary transition duration-300">Tienda</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-brand-primary transition duration-300">Aliados</a></li>
                        <li><a href="./colegios.html" class="text-gray-400 hover:text-brand-primary transition duration-300">Colegios</a></li>
                        <li><a href="#" class="text-gray-400 hover:text-brand-primary transition duration-300">Intranet</a></li>
                    </ul>
                </div>

                <div class="w-full md:w-1/4">
                    <h4 class="text-lg font-semibold mb-3">Encuéntranos</h4>
                    <div class="flex space-x-4">
                        <a href="https://facebook.com" target="_blank" class="text-gray-400 hover:text-brand-primary text-xl transition duration-300">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="https://instagram.com" target="_blank" class="text-gray-400 hover:text-brand-primary text-xl transition duration-300">
                            <i class="fab fa-instagram"></i>
                        </a>
                        <a href="https://twitter.com" target="_blank" class="text-gray-400 hover:text-brand-primary text-xl transition duration-300">
                            <i class="fab fa-twitter"></i>
                        </a>
                    </div>
                </div>
            </div>
            
            <div class="mt-8 pt-6 border-t border-gray-700 text-center">
                <p class="text-sm text-gray-500">&copy; 2025 Smart Books. Todos los derechos reservados.</p>
            </div>
        </div>
    </footer>

    <a href="https://wa.me/573000000000" target="_blank"
        class="fixed bottom-6 right-6 bg-green-500 text-white p-4 rounded-full shadow-lg text-2xl z-50 hover:bg-green-600 transition duration-300">
        <i class="fab fa-whatsapp"></i>
    </a>

    <script>
        // --- 1. DEFINICIONES GLOBALES ---
        const schoolSelectButton = document.getElementById('school-select-button');
        const schoolDropdown = document.getElementById('school-dropdown');
        const schoolList = document.getElementById('school-list');
        const schoolSearchInput = document.getElementById('school-search-input');
        
        const courseSelectButton = document.getElementById('course-select-button');
        const courseDropdown = document.getElementById('course-dropdown');
        const courseList = document.getElementById('course-list');
        const courseDropdownContainer = document.getElementById('course-dropdown-container');
        
        const packageCard = document.getElementById('package-card');
        const searchLoading = document.getElementById('search-loading');
        const initialMessage = document.getElementById('initial-message');
        
        let ALL_SCHOOLS = [];
        let selectedSchool = null;
        let activeDropdownId = null;


        // --- 2. DATOS ESTÁTICOS (SIMULACIÓN DE BASE DE DATOS) ---
        const STATIC_SCHOOL_DATA = [
            { 
                ID: 1, 
                COLEGIO: "GIMNASIO SAN ANGELO", 
                CIUDAD: "Bogotá", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 2, 
                COLEGIO: "COLEGIO NUEVO MILENIO", 
                CIUDAD: "Medellín", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 3, 
                COLEGIO: "LICEO MODERNO", 
                CIUDAD: "Cali", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 4, 
                COLEGIO: "INSTITUTO BILINGÜE", 
                CIUDAD: "Barranquilla", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 5, 
                COLEGIO: "COLEGIO DEL MAR", 
                CIUDAD: "Cartagena", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 6, 
                COLEGIO: "ACADEMIA MONTESSORI", 
                CIUDAD: "Bogotá", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 7, 
                COLEGIO: "LICEO DE LOS ANDES", 
                CIUDAD: "Medellín", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 8, 
                COLEGIO: "ESCUELA DE ARTE", 
                CIUDAD: "Cali", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 9, 
                COLEGIO: "COLEGIO TECNOLÓGICO", 
                CIUDAD: "Barranquilla", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 10, 
                COLEGIO: "INSTITUTO SANTA INÉS", 
                CIUDAD: "Cartagena", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 11, 
                COLEGIO: "COLEGIO EXPERIMENTAL", 
                CIUDAD: "Bogotá", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
            { 
                ID: 12, 
                COLEGIO: "COLEGIO ALTO DE LA SIERRA", 
                CIUDAD: "Medellín", 
                PAIS: "Colombia",
                'PRIMERO': 'Kit 1ro Primaria',
                'SEGUNDO': 'Kit 2do Primaria',
                'TERCERO': 'Kit 3ro Primaria',
                'CUARTO': 'Kit 4to Primaria',
                'QUINTO': 'Kit 5to Primaria',
                'SEXTO': 'Kit 6to Secundaria',
                'SEPTIMO': 'Kit 7mo Secundaria',
                'OCTAVO': 'Kit 8mo Secundaria',
                'NOVENO': 'Kit 9no Secundaria',
                'DECIMO': 'Kit 10mo Secundaria',
                'UNDECIMO': 'Kit 11mo Secundaria'
            },
        ];
        
        const GRADES = [
            { key: 'PRIMERO', name: 'Primero' },
            { key: 'SEGUNDO', name: 'Segundo' },
            { key: 'TERCERO', name: 'Tercero' },
            { key: 'CUARTO', name: 'Cuarto' },
            { key: 'QUINTO', name: 'Quinto' },
            { key: 'SEXTO', name: 'Sexto' },
            { key: 'SEPTIMO', name: 'Séptimo' },
            { key: 'OCTAVO', name: 'Octavo' },
            { key: 'NOVENO', name: 'Noveno' },
            { key: 'DECIMO', name: 'Décimo' },
            { key: 'UNDECIMO', name: 'Undécimo' }
        ];

        // --- 3. FUNCIONES DE MANEJO DE UI Y LÓGICA DE NEGOCIO ---

        // Función general para alternar un dropdown
        function toggleDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const button = dropdownId === 'school-dropdown' ? schoolSelectButton : courseSelectButton;

            if (activeDropdownId && activeDropdownId !== dropdownId) {
                // Si hay otro dropdown abierto, ciérralo
                closeDropdown(activeDropdownId);
            }

            if (dropdown.classList.contains('dropdown-content-visible')) {
                // Cerrar dropdown
                closeDropdown(dropdownId);
            } else {
                // Abrir dropdown
                dropdown.classList.add('dropdown-content-visible');
                activeDropdownId = dropdownId;
                // Rotar el ícono (solo para el botón principal)
                const icon = button.querySelector('.fa-chevron-down');
                if (icon) {
                    icon.style.transform = 'rotate(180deg)';
                }
            }
        }

        // Función para cerrar un dropdown
        function closeDropdown(dropdownId) {
            const dropdown = document.getElementById(dropdownId);
            const button = dropdownId === 'school-dropdown' ? schoolSelectButton : courseSelectButton;
            
            dropdown.classList.remove('dropdown-content-visible');
            if (activeDropdownId === dropdownId) {
                activeDropdownId = null;
            }
            
            // Revertir la rotación del ícono
            const icon = button.querySelector('.fa-chevron-down');
            if (icon) {
                icon.style.transform = 'rotate(0deg)';
            }
        }

        // Función para renderizar la lista de colegios
        function renderSchoolList(schools) {
            schoolList.innerHTML = '';
            if (schools.length === 0) {
                schoolList.innerHTML = '<div class="p-3 text-gray-500 text-center">No se encontraron colegios.</div>';
                return;
            }

            schools.forEach(school => {
                const item = document.createElement('div');
                item.className = 'dropdown-item p-3 hover:bg-gray-100 flex justify-between items-center text-gray-700';
                item.innerHTML = `
                    <span>${school.COLEGIO}</span>
                    <span class="text-sm text-gray-500">${school.CIUDAD}</span>
                `;
                item.onclick = () => {
                    handleSchoolSelection(school);
                    closeDropdown('school-dropdown');
                };
                schoolList.appendChild(item);
            });
        }

        // Función para filtrar la lista de colegios
        function filterSchoolList() {
            const filter = schoolSearchInput.value.toUpperCase();
            const filteredSchools = ALL_SCHOOLS.filter(school => 
                school.COLEGIO.toUpperCase().includes(filter) ||
                school.CIUDAD.toUpperCase().includes(filter)
            );
            renderSchoolList(filteredSchools);
        }

        // Maneja la selección de colegio (Muestra Dropdown 2)
        function handleSchoolSelection(school) {
            selectedSchool = school;

            // 1. OCULTAR TODOS LOS RESULTADOS Y ESTADOS DE CARGA
            packageCard.classList.add('hidden'); // MANTENER OCULTA LA TARJETA AL CAMBIAR DE COLEGIO
            packageCard.style.display = 'none'; // Asegurar ocultamiento
            searchLoading.style.display = 'none'; 

            // 2. Actualiza el botón de colegio
            schoolSelectButton.innerHTML = school.COLEGIO + 
                `<i class="fas fa-chevron-down text-base ml-2 transition-transform duration-300"></i>`;
            schoolSelectButton.classList.remove('text-gray-500');
            schoolSelectButton.classList.add('text-gray-700', 'hover:border-brand-primary');

            // 3. Reinicia y actualiza el botón de curso
            courseSelectButton.innerHTML = `Selecciona tu Curso <i class="fas fa-chevron-down text-base ml-2 transition-transform duration-300"></i>`;
            courseSelectButton.disabled = false;

            // 4. Muestra los cursos disponibles (renderCourseList)
            renderCourseList(school);

            // 5. Muestra el dropdown de cursos con una animación (transición)
            courseDropdownContainer.classList.remove('course-dropdown-container-hidden');
            courseDropdownContainer.classList.add('course-dropdown-container-visible');

            // 6. Muestra el mensaje de selección de curso
            initialMessage.textContent = `Selecciona un curso para ${school.COLEGIO}.`;
            initialMessage.classList.remove('hidden');
        }

        // Función para renderizar la lista de cursos
        function renderCourseList(school) {
            courseList.innerHTML = '';
            
            // Filtrar y renderizar solo los grados que tienen un kit (valor diferente de 0/null)
            const availableGrades = GRADES.filter(grade => {
                const kitValue = school[grade.key];
                return kitValue && String(kitValue).trim() !== '0' && String(kitValue).toUpperCase() !== 'NULL';
            });

            if (availableGrades.length === 0) {
                courseList.innerHTML = '<div class="p-3 text-gray-500 text-center">No se encontraron kits educativos para ningún curso en este colegio.</div>';
                courseSelectButton.disabled = true;
                return;
            }

            availableGrades.forEach(grade => {
                const item = document.createElement('div');
                item.className = 'dropdown-item p-3 hover:bg-gray-100 text-gray-700';
                item.textContent = grade.name;
                item.onclick = () => {
                    handleCourseSelection(grade.key, grade.name, school.ID);
                    closeDropdown('course-dropdown');
                };
                courseList.appendChild(item);
            });
        }

        // Maneja la selección del curso (Muestra la Tarjeta de Resultado)
        async function handleCourseSelection(gradeKey, gradeName, schoolId) {

            // 1. Actualiza el botón de curso
            courseSelectButton.innerHTML = gradeName + 
                `<i class="fas fa-chevron-down text-base ml-2 transition-transform duration-300"></i>`;

            // 2. Oculta la tarjeta y el mensaje inicial antes de la búsqueda
            packageCard.classList.add('hidden'); // OCULTAR LA TARJETA ANTES DE LA BÚSQUEDA
            packageCard.style.display = 'none'; // Asegurar ocultamiento
            initialMessage.classList.add('hidden');

            // 3. Inicia la animación de búsqueda
            searchLoading.style.display = 'flex';

            // SIMULACION de la llamada API para obtener el paquete
            await new Promise(resolve => setTimeout(resolve, 800)); // Simula un pequeño retraso

            try {
                // Simulación: El paquete de información ya está en selectedSchool
                const packageInfo = selectedSchool[gradeKey] ? String(selectedSchool[gradeKey]).trim() : '0';

                if (packageInfo === '0' || packageInfo.toUpperCase() === 'NULL') {
                    throw new Error("Paquete no disponible");
                }

                // Generar cantidad de libros aleatoria (entre 4 y 7)
                const randomBookCount = Math.floor(Math.random() * (7 - 4 + 1)) + 4;

                searchLoading.style.display = 'none';
                
                // Muestra la tarjeta con los datos
                displayPackageCard(selectedSchool, gradeName, packageInfo, randomBookCount);

            } catch (error) {
                console.error('Error al obtener el paquete:', error);
                searchLoading.style.display = 'none';
                initialMessage.textContent = 'Lo sentimos, no pudimos cargar la información del kit educativo para este curso/colegio. Intenta de nuevo más tarde.';
                initialMessage.classList.remove('hidden');
            }
        }

        // Muestra la tarjeta con el resultado
        function displayPackageCard(school, gradeName, packageInfo, bookCount) {

            // *** MODIFICACIÓN CLAVE PARA MOSTRARLA ***
            packageCard.style.display = 'flex !important'; // <-- CAMBIA A 'flex' para mostrarla
            packageCard.classList.remove('hidden'); 
            
            // Llenar los campos de la tarjeta
            document.getElementById('card-school-name').textContent = school.COLEGIO;
            document.getElementById('card-course-name').textContent = gradeName;
            document.getElementById('card-book-count').textContent = bookCount;
            // Aquí iría el código para el nombre real del paquete si fuera necesario

            // Añadir animación de entrada
            packageCard.classList.remove('opacity-0', 'translate-y-4');
            packageCard.classList.add('opacity-100', 'translate-y-0');
        }


        // --- 4. FUNCIÓN PRINCIPAL DE CARGA DE DATOS ---
        function loadSchools() {
            // En lugar de fetch, usamos los datos estáticos
            ALL_SCHOOLS = STATIC_SCHOOL_DATA;
            
            // *** CORRECCIÓN CLAVE! OCULTAR LA TARJETA AL INICIO ***
            packageCard.classList.add('hidden'); // Añadido para forzar el ocultamiento.
            packageCard.style.display = 'none'; // Asegurar ocultamiento
            searchLoading.style.display = 'none'; 
            
            // Actualiza el UI al cargar
            renderSchoolList(ALL_SCHOOLS);
            schoolSelectButton.innerHTML = `Selecciona tu Colegio <i class="fas fa-chevron-down text-base ml-2 transition-transform duration-300"></i>`;
            schoolSelectButton.classList.remove('school-loading', 'text-gray-500');
            schoolSelectButton.classList.add('text-gray-700', 'hover:border-brand-primary');
            schoolSelectButton.disabled = false;
            schoolSearchInput.disabled = false;
            
            initialMessage.textContent = 'Por favor, selecciona un colegio para empezar.';
            
        }


        // --- 5. EVENT LISTENERS ---

        // Cerrar dropdowns al hacer clic fuera
        document.addEventListener('click', (event) => {
            if (activeDropdownId) {
                const buttonId = activeDropdownId === 'school-dropdown' ? 'school-select-button' : 'course-select-button';
                const button = document.getElementById(buttonId);
                const dropdown = document.getElementById(activeDropdownId);

                if (button && !button.contains(event.target) && !dropdown.contains(event.target)) {
                    closeDropdown(activeDropdownId);
                }
            }
        });

        // Evento de Carga de la Página
        document.addEventListener('DOMContentLoaded', loadSchools);
        
        // Efecto Sticky Nav
        window.onscroll = function() { stickyNavbar() };

        var navbar = document.getElementById("navbar");
        var sticky = navbar.offsetTop;

        function stickyNavbar() {
            if (window.pageYOffset > sticky) {
                navbar.classList.add("sticky-nav");
            } else {
                navbar.classList.remove("sticky-nav");
            }
        }

    </script>
</body>

</html>